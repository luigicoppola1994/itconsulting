<div class="main-layout-container">
<app-sidebar 
  [isOpen]="showSidebar" 
  [selectedItem]="selectedMenuItem"
  [shouldAnimate]="shouldAnimateSidebar"
  (closeSidebar)="showSidebar = false"
  (backToHome)="onBackToHome()"
  (toggleSidebar)="showSidebar = !showSidebar"
  (voiceAction)="onSidebarVoiceAction($event)">
</app-sidebar>

  <div class="content-area" [class.content-shifted]="showSidebar">
    <router-outlet></router-outlet>
  </div>

  <div class="voice-control-bar" 
       [class]="getVoiceControlBarClasses().join(' ')"
       [ngStyle]="getVoiceControlBarStyles()">
    
    <div class="voice-control-content">
      <div class="agent-name">{{ getCurrentAgentName() }}</div>
      
      <button class="microphone-button" 
              (click)="onMicrophoneClick()"
              [disabled]="conversationState.status === 'connecting'"
              [class.connected]="conversationState.status === 'connected'"
              [class.connecting]="conversationState.status === 'connecting'"
              [class.speaking]="conversationState.isAgentSpeaking"
              [class.listening]="conversationState.isUserSpeaking"
              [attr.aria-label]="conversationState.status === 'connected' ? 'Termina conversazione' : 'Inizia conversazione vocale'">
        
        <!-- Icona normale -->
        <svg *ngIf="conversationState.status === 'disconnected'" 
             xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
          <path d="M12 2c-1.7 0-3 1.3-3 3v6c0 1.7 1.3 3 3 3s3-1.3 3-3V5c0-1.7-1.3-3-3-3zm0 14c-2.8 0-5-2.2-5-5H5c0 3.9 3.1 7 7 7s7-3.1 7-7h-2c0 2.8-2.2 5-5 5z"/>
          <rect x="11" y="19" width="2" height="3"/>
        </svg>
        
        <!-- Icona connesso/parlando -->
        <svg *ngIf="conversationState.status === 'connected'" 
             xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
          <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm5 11H7v-2h10v2z"/>
        </svg>
        
        <!-- Spinner di caricamento -->
        <div *ngIf="conversationState.status === 'connecting'" class="loading-spinner">
          <div class="spinner"></div>
        </div>
      </button>
      
      <div class="instructions-text">{{ getVoiceControlText() }}</div>
    </div>
  </div>
</div>