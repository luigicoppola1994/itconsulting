<div class="homepage-container" [class.exiting]="isExiting">
  <div class="animated-bg">
    <div class="gradient-layer"></div>
  </div>

  <div class="main-grid-layout">
    <div class="left-panel">
      <div class="logo-container">
        <img src="https://www.itconsultingsrl.it/wp-content/uploads/2020/09/itconsulting-sito-web-logo.svg" alt="IT Consulting Logo" class="company-logo">
      </div>

      <div class="welcome-section">
        <h1 class="welcome-title">Benvenuti<br>sul nostro sito<br>intelligente <span class="highlight">AI</span></h1>
        <p class="welcome-tagline">Esplora soluzioni innovative e connettiti con la nostra AI avanzata per trasformare il tuo business.</p>
        <div class="prompt-text">
          <p>Scegli la tua area di interesse o parla direttamente</p>
          <svg class="arrow-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
            <path d="M12 4l-1.41 1.41L16.17 11H4v2h12.17l-5.58 5.59L12 20l8-8z"/>
          </svg>
        </div>
      </div>
    </div>

    <div class="right-panel">
      <div class="avatars-grid-wrapper">
        <div class="avatars-pyramid">
          
          <!-- PRIMA RIGA: 1 Avatar Centrale CON ILLUMINAZIONE -->
          <div class="pyramid-row-1">
            <div class="avatar-item"
                 [class]="getAvatarClasses(avatars[0]).join(' ')"
                 [ngStyle]="getAvatarStyles(avatars[0])"
                 role="button"
                 tabindex="0"
                 [attr.aria-label]="'Accedi a ' + avatars[0].name">
              
              <!-- Click principale per navigazione -->
              <div class="avatar-main-area" (click)="onAvatarClick(avatars[0])">
                <div class="avatar-glow"></div>
                <div class="avatar-border">
                  <img [src]="avatars[0].image" [alt]="avatars[0].name" class="avatar-image-fill">
                </div>
                <p class="avatar-name">{{ avatars[0].name }}</p>
              </div>
              
              <!-- Pulsante vocale separato -->
              <button class="voice-select-btn" 
                      (click)="onAvatarVoiceSelect(avatars[0])"
                      [class.active]="isAvatarSelectedForVoice(avatars[0])"
                      [class.connected]="isAvatarConnected(avatars[0])"
                      [class.speaking]="isAvatarSpeaking(avatars[0])"
                      [attr.aria-label]="'Seleziona ' + avatars[0].name + ' per conversazione vocale'">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M12 14c1.66 0 2.99-1.34 2.99-3L15 5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3zm5.3-3c0 3.53-2.64 6.44-6.3 6.93V21h-2v-3.07c-3.66-.49-6.3-3.4-6.3-6.93h2c0 2.76 2.24 5 5 5s5-2.24 5-5h2z"/>
                </svg>
              </button>
            </div>
          </div>

          <!-- SECONDA RIGA: 2 Avatar Centrati CON ILLUMINAZIONE -->
          <div class="pyramid-row-2">
            <div class="avatar-item"
                 [class]="getAvatarClasses(avatars[1]).join(' ')"
                 [ngStyle]="getAvatarStyles(avatars[1])"
                 role="button"
                 tabindex="0"
                 [attr.aria-label]="'Accedi a ' + avatars[1].name">
              
              <div class="avatar-main-area" (click)="onAvatarClick(avatars[1])">
                <div class="avatar-glow"></div>
                <div class="avatar-border">
                  <img [src]="avatars[1].image" [alt]="avatars[1].name" class="avatar-image-fill">
                </div>
                <p class="avatar-name">{{ avatars[1].name }}</p>
              </div>
              
              <button class="voice-select-btn" 
                      (click)="onAvatarVoiceSelect(avatars[1])"
                      [class.active]="isAvatarSelectedForVoice(avatars[1])"
                      [class.connected]="isAvatarConnected(avatars[1])"
                      [class.speaking]="isAvatarSpeaking(avatars[1])"
                      [attr.aria-label]="'Seleziona ' + avatars[1].name + ' per conversazione vocale'">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M12 14c1.66 0 2.99-1.34 2.99-3L15 5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3zm5.3-3c0 3.53-2.64 6.44-6.3 6.93V21h-2v-3.07c-3.66-.49-6.3-3.4-6.3-6.93h2c0 2.76 2.24 5 5 5s5-2.24 5-5h2z"/>
                </svg>
              </button>
            </div>

            <div class="avatar-item"
                 [class]="getAvatarClasses(avatars[2]).join(' ')"
                 [ngStyle]="getAvatarStyles(avatars[2])"
                 role="button"
                 tabindex="0"
                 [attr.aria-label]="'Accedi a ' + avatars[2].name">
              
              <div class="avatar-main-area" (click)="onAvatarClick(avatars[2])">
                <div class="avatar-glow"></div>
                <div class="avatar-border">
                  <img [src]="avatars[2].image" [alt]="avatars[2].name" class="avatar-image-fill">
                </div>
                <p class="avatar-name">{{ avatars[2].name }}</p>
              </div>
              
              <button class="voice-select-btn" 
                      (click)="onAvatarVoiceSelect(avatars[2])"
                      [class.active]="isAvatarSelectedForVoice(avatars[2])"
                      [class.connected]="isAvatarConnected(avatars[2])"
                      [class.speaking]="isAvatarSpeaking(avatars[2])"
                      [attr.aria-label]="'Seleziona ' + avatars[2].name + ' per conversazione vocale'">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M12 14c1.66 0 2.99-1.34 2.99-3L15 5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3zm5.3-3c0 3.53-2.64 6.44-6.3 6.93V21h-2v-3.07c-3.66-.49-6.3-3.4-6.3-6.93h2c0 2.76 2.24 5 5 5s5-2.24 5-5h2z"/>
                </svg>
              </button>
            </div>
          </div>

          <!-- TERZA RIGA: 3 Avatar Centrati CON ILLUMINAZIONE -->
          <div class="pyramid-row-3">
            <div class="avatar-item"
                 [class]="getAvatarClasses(avatars[3]).join(' ')"
                 [ngStyle]="getAvatarStyles(avatars[3])"
                 role="button"
                 tabindex="0"
                 [attr.aria-label]="'Accedi a ' + avatars[3].name">
              
              <div class="avatar-main-area" (click)="onAvatarClick(avatars[3])">
                <div class="avatar-glow"></div>
                <div class="avatar-border">
                  <img [src]="avatars[3].image" [alt]="avatars[3].name" class="avatar-image-fill">
                </div>
                <p class="avatar-name">{{ avatars[3].name }}</p>
              </div>
              
              <button class="voice-select-btn" 
                      (click)="onAvatarVoiceSelect(avatars[3])"
                      [class.active]="isAvatarSelectedForVoice(avatars[3])"
                      [class.connected]="isAvatarConnected(avatars[3])"
                      [class.speaking]="isAvatarSpeaking(avatars[3])"
                      [attr.aria-label]="'Seleziona ' + avatars[3].name + ' per conversazione vocale'">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M12 14c1.66 0 2.99-1.34 2.99-3L15 5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3zm5.3-3c0 3.53-2.64 6.44-6.3 6.93V21h-2v-3.07c-3.66-.49-6.3-3.4-6.3-6.93h2c0 2.76 2.24 5 5 5s5-2.24 5-5h2z"/>
                </svg>
              </button>
            </div>

            <div class="avatar-item"
                 [class]="getAvatarClasses(avatars[4]).join(' ')"
                 [ngStyle]="getAvatarStyles(avatars[4])"
                 role="button"
                 tabindex="0"
                 [attr.aria-label]="'Accedi a ' + avatars[4].name">
              
              <div class="avatar-main-area" (click)="onAvatarClick(avatars[4])">
                <div class="avatar-glow"></div>
                <div class="avatar-border">
                  <img [src]="avatars[4].image" [alt]="avatars[4].name" class="avatar-image-fill">
                </div>
                <p class="avatar-name">{{ avatars[4].name }}</p>
              </div>
              
              <button class="voice-select-btn" 
                      (click)="onAvatarVoiceSelect(avatars[4])"
                      [class.active]="isAvatarSelectedForVoice(avatars[4])"
                      [class.connected]="isAvatarConnected(avatars[4])"
                      [class.speaking]="isAvatarSpeaking(avatars[4])"
                      [attr.aria-label]="'Seleziona ' + avatars[4].name + ' per conversazione vocale'">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M12 14c1.66 0 2.99-1.34 2.99-3L15 5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3zm5.3-3c0 3.53-2.64 6.44-6.3 6.93V21h-2v-3.07c-3.66-.49-6.3-3.4-6.3-6.93h2c0 2.76 2.24 5 5 5s5-2.24 5-5h2z"/>
                </svg>
              </button>
            </div>

            <div class="avatar-item"
                 [class]="getAvatarClasses(avatars[5]).join(' ')"
                 [ngStyle]="getAvatarStyles(avatars[5])"
                 role="button"
                 tabindex="0"
                 [attr.aria-label]="'Accedi a ' + avatars[5].name">
              
              <div class="avatar-main-area" (click)="onAvatarClick(avatars[5])">
                <div class="avatar-glow"></div>
                <div class="avatar-border">
                  <img [src]="avatars[5].image" [alt]="avatars[5].name" class="avatar-image-fill">
                </div>
                <p class="avatar-name">{{ avatars[5].name }}</p>
              </div>
              
              <button class="voice-select-btn" 
                      (click)="onAvatarVoiceSelect(avatars[5])"
                      [class.active]="isAvatarSelectedForVoice(avatars[5])"
                      [class.connected]="isAvatarConnected(avatars[5])"
                      [class.speaking]="isAvatarSpeaking(avatars[5])"
                      [attr.aria-label]="'Seleziona ' + avatars[5].name + ' per conversazione vocale'">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M12 14c1.66 0 2.99-1.34 2.99-3L15 5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3zm5.3-3c0 3.53-2.64 6.44-6.3 6.93V21h-2v-3.07c-3.66-.49-6.3-3.4-6.3-6.93h2c0 2.76 2.24 5 5 5s5-2.24 5-5h2z"/>
                </svg>
              </button>
            </div>
          </div>

        </div>
      </div>

      <!-- Voice Control Bar AGGIORNATA con Illuminazione Dinamica -->
      <div class="voice-control-bar" 
           [class]="getVoiceControlBarClasses().join(' ')"
           [ngStyle]="getVoiceControlBarStyles()">
        
        <div class="agent-name">{{ getCurrentAgentName() }}</div>
        
        <button class="microphone-button" 
                (click)="onMicrophoneClick()"
                [disabled]="conversationState.status === 'connecting'"
                [class.connected]="conversationState.status === 'connected'"
                [class.connecting]="conversationState.status === 'connecting'"
                [class.speaking]="conversationState.isAgentSpeaking"
                [class.listening]="conversationState.isUserSpeaking"
                [attr.aria-label]="conversationState.status === 'connected' ? 'Termina conversazione' : 'Inizia conversazione vocale'">
          
          <!-- Icona normale -->
          <svg *ngIf="conversationState.status === 'disconnected'" 
               xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
            <path d="M12 14c1.66 0 2.99-1.34 2.99-3L15 5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3zm5.3-3c0 3.53-2.64 6.44-6.3 6.93V21h-2v-3.07c-3.66-.49-6.3-3.4-6.3-6.93h2c0 2.76 2.24 5 5 5s5-2.24 5-5h2z"/>
          </svg>
          
          <!-- Icona connesso/parlando -->
          <svg *ngIf="conversationState.status === 'connected'" 
               xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm5 11H7v-2h10v2z"/>
          </svg>
          
          <!-- Spinner di caricamento -->
          <div *ngIf="conversationState.status === 'connecting'" class="loading-spinner">
            <div class="spinner"></div>
          </div>
        </button>
        
        <div class="instructions-text">{{ getVoiceControlText() }}</div>
      </div>

      <!-- Messaggio dall'AI CON ANIMAZIONE -->
      <div class="ai-message-preview" 
           *ngIf="conversationState.lastMessage && conversationState.status === 'connected'"
           [@slideInUp]>
        <div class="message-bubble">
          <p>{{ conversationState.lastMessage }}</p>
        </div>
      </div>

      <!-- Indicatori di Volume - SEMPRE VISIBILI -->
      <div class="volume-indicators">
        <div class="volume-meter input-meter">
          <label>Input</label>
          <div class="meter-bar">
            <div class="meter-fill" 
                 [style.width.%]="conversationState.inputVolume * 100"
                 [class.active]="conversationState.isUserSpeaking"></div>
          </div>
        </div>
        <div class="volume-meter output-meter">
          <label>Output</label>
          <div class="meter-bar">
            <div class="meter-fill" 
                 [style.width.%]="conversationState.outputVolume * 100"
                 [class.active]="conversationState.isAgentSpeaking"></div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

